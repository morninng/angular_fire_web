"use strict";angular.module("mixideaWebApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","ui.router","ui.bootstrap","firebase"]),angular.module("mixideaWebApp").config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("/eventsearch_layout_three_column",{url:"/event",views:{RootView:{templateUrl:"views/event/event_layout_three.html"}}}).state("/eventsearch_layout_three_column.list",{url:"/list",views:{event_left:{templateUrl:"views/event/event_filter.html",controller:"EventFilterCtrl"},event_main:{templateUrl:"views/event/event_list.html",controller:"EventListCtrl"},event_right:{templateUrl:"views/right_column_ad.html"}}}).state("/eventsearch_layout_two_column",{url:"/event",views:{RootView:{templateUrl:"views/event/event_layout_two.html"}}}).state("/eventsearch_layout_two_column.calendar",{url:"/calendar",views:{event_left:{templateUrl:"views/event/event_filter.html",controller:"EventFilterCtrl"},event_main:{templateUrl:"views/event/event_calendar.html",controller:"EventCalendarCtrl"}}}).state("/eventcontext_layout_two_column",{url:"/eventcontext",views:{RootView:{templateUrl:"views/event/eventcontext_layout.html"}}}).state("/eventcontext_layout_two_column.context",{url:"/context/:id",views:{eventcontext_main:{templateUrl:"views/event/event_context.html",controller:"EventContextCtrl"},eventcontext_right:{templateUrl:"views/right_column_ad.html"}}})}]),angular.module("mixideaWebApp").controller("EventContextCtrl",["$scope","$stateParams","$timeout","UserAuthService",function(a,b,c,d){function e(b){a.total_num=0;var d=!1;a.participant_audience&&c(function(){a.participant_audience.length=0});var e=0;if(b)for(var h in b.audience)f(h,a.participant_audience),a.total_num++,e++,h==m.own_uid&&(d=!0,n="audience");c(function(){a.available_audience=g("audience",e),d||(a.already_joined=!1)})}function f(a,b){var d=o.child("users/user_basic/"+a);d.once("value",function(a){c(function(){var c=a.val(),d=a.key();c.id=d,d==m.own_uid?c.yourself=!0:c.yourself=!1,b.push(c)})})}function g(b,c){var d=a.event_obj.deb_style;if(a.total_num>9)return!1;switch(d){case"NA":switch(b){case"debater":if(6>c)return!0;break;case"audience":if(6>c)return!0;break;case"aud_or_debater":return!0}break;case"Asian":case"BP":switch(b){case"debater":if(8>c)return!0;break;case"audience":if(3>c)return!0;break;case"aud_or_debater":return!0}}return!1}function h(a){var b=o.child("event_related/participants/"+l+"/event_role/"+a+"/"+m.own_uid),c=o.child("event_related/participants/"+l+"/full/"+m.own_uid);c.set(!0).then(function(a){return b.set(!0)}).then(function(){alert("succeed to join")},function(){alert("error to save data")})}function i(a){var b=(p.child("participant/"+a+"/member/"+m.own_uid),o.child("event_related/participants/"+l+"/"+m.own_uid),o.child("event_related/participants/"+l+"/event_role/"+a+"/"+m.own_uid)),c=o.child("event_related/participants/"+l+"/full/"+m.own_uid);b.set(null).then(function(a){return c.set(null)}).then(function(){alert("succeed to cancel")},function(){alert("error to cancel")})}function j(a){if(!m.own_uid)return void alert("you need to login to join the game");var b=p.child("participants_num/"+a);b.transaction(function(b){var c=!0,d=b;if(b){if(c=g(a,b),!c)return}else{if(c=g(a,0),!c)return;d=0}return d+=1},function(b,c,d){console.log("transaction complete"),b?alert("transaction failed"+b):c?h(a):alert("other person may take a role and cannot login more")})}function k(a){var b=p.child("participants_num/"+a);b.transaction(function(a){var b=a-1;return b})}console.log("event context controller called");var l=b.id,m=d;a.event_obj=new Object,a.participant_audience=new Array,a.participant_debater=new Array,a.participant_aud_or_debater=new Array,a.available_audience=!1,a.available_debater=!1,a.available_aud_or_debater=!1,a.already_joined=!0;var n=null,o=new Firebase("https://mixidea.firebaseio.com/"),p=o.child("event_related/event/"+l);p.once("value",function(b){a.event_obj=b.val()},function(){alert("fail to load event data")});var o=new Firebase("https://mixidea.firebaseio.com/"),q=o.child("event_related/participants/"+l+"/event_role");q.on("value",function(b){a.available_audience=!1,a.available_debater=!1,a.available_aud_or_debater=!1,a.already_joined=!0,a.total_num=0;var c=b.val();e(c)},function(){alert("fail to load participant data")}),a.join_as_debater=function(){j("debater")},a.join_as_audience=function(){j("audience")},a.join_as_AudOrDebater=function(){j("aud_or_debater")},a.cancel_participante=function(){n||alert("something went wrong, please refresh and try again"),k(n),i(n)}}]),angular.module("mixideaWebApp").controller("HeaderUserCtrl",["$scope","UserAuthService","$uibModal",function(a,b,c){a.user=b,a.logout=function(){a.user.logout()},a.show_lgoin_form=function(){console.log("show login form is called");c.open({templateUrl:"views/login_form.html",controller:"LoginFormCtrl",backdrop:"static",size:"sm"})}}]),angular.module("mixideaWebApp").controller("LoginFormCtrl",["$scope","UserAuthService","$uibModalInstance",function(a,b,c){console.log("login form control is called"),a.fb_login_show=!0,a.fb_login_loading_show=!1,a.lang_type=null,a.user_introduction=null,a.user=b;var d=new Firebase("https://mixidea.firebaseio.com/");a.login_fb=function(){console.log("facebook login is clicked"),a.fb_login_show=!1,a.fb_login_loading_show=!0,a.user.login()},a.close_modal=function(){c.close()},a.click_introduction_input=function(){var b=a.user_introduction;if(!b)return void alert("input your self introduction");var c=a.user.own_uid,e=d.child("users/user_ext/"+c+"/profile/introduction");e.set(b)},a.click_language_select=function(){var b=a.lang_type;if(!b)return void alert("select one of the english types");var c=a.user.own_uid,e=d.child("users/user_ext/"+c+"/profile/lang_type");e.set(b)},a.$watch("user.regist_complete",function(){if(1==a.user.regist_complete){var b=document.getElementById("myCarousel"),e=angular.element(b),f=a.user.own_uid,g=d.child("users/user_ext/"+f+"/profile/lang_type"),h=d.child("users/user_ext/"+f+"/profile/introduction");g.on("value",function(a){var b=a.val();b?(console.log(b),h.on("value",function(a){var b=a.val();b?c.close():(e.carousel(2),e.carousel("pause"))})):(e.carousel(1),e.carousel("pause"),console.log(b))},function(){console.log(lang_type)})}})}]),angular.module("mixideaWebApp").controller("CreateEventCtrl",["$scope","$uibModalInstance",function(a,b){console.log("CreateEventCtrl"),a.event_create_status="input",a.event_date=null,a.event_time=null,a.context=null,a.deb_style=null,a.exp_deb_skill=null,a.exp_lang_skil=null,a.event_time=null,a.date_time=null,a.motion=null,a.prerequisit=null,a.event_id=null,a.click_cancel=function(){console.log("cancel button is clicked"),b.close()}}]),angular.module("mixideaWebApp").controller("CreateEventInputCtrl",["$scope",function(a){var b=new Date;a.minDate=b.setDate(b.getDate()-1);var c=new Date(2015,1,1,0,0);a.event_time=c,a.context_maxchar=350,a.context_minchar=20,a.show_time=!1,a.click_create=function(){return console.log("create button is clicked"),console.log(a.$parent.event_create_status),!a.event_date||!a.context||a.context.length>a.context_maxchar||a.context.length<a.context_minchar||!a.show_time?void alert("input data error"):(a.$parent.$parent.date_time=new Date,a.$parent.$parent.date_time.setYear(a.event_date.getFullYear()),a.$parent.$parent.date_time.setMonth(a.event_date.getMonth()),a.$parent.$parent.date_time.setDate(a.event_date.getDate()),a.$parent.$parent.date_time.setHours(a.event_time.getHours()),a.$parent.$parent.date_time.setMinutes(a.event_time.getMinutes()),a.$parent.$parent.event_date=a.event_date,a.$parent.$parent.context=a.context,a.$parent.$parent.deb_style=a.deb_style,a.$parent.$parent.exp_deb_skill=a.exp_deb_skill,a.$parent.$parent.exp_lang_skil=a.exp_lang_skil,a.$parent.$parent.event_time=a.event_time,a.$parent.$parent.motion=a.motion,a.$parent.$parent.prerequisit=a.prerequisit,void(a.$parent.$parent.event_create_status="confirm"))},a.time_changed=function(){a.show_time=!0}}]),angular.module("mixideaWebApp").controller("CreateEventConfirmCtrl",["$scope","UserAuthService","$timeout",function(a,b,c){a.click_save=function(){var d=a.$parent.$parent.date_time.getTime(),e=60*a.$parent.$parent.date_time.getUTCHours()+a.$parent.$parent.date_time.getUTCMinutes();console.log("sss");var f={date_time:d,time:e,deb_style:a.$parent.$parent.deb_style,context:a.$parent.$parent.context,deb_skill:a.$parent.$parent.exp_deb_skill,lang_skil:a.$parent.$parent.exp_lang_skil,motion:a.$parent.$parent.motion,prerequisit:a.$parent.$parent.prerequisit,created_by:b.own_uid},g={deb_style:a.$parent.$parent.deb_style,motion:a.$parent.$parent.motion,game_status:"introduction",type:"debate"},h=new Firebase("https://mixidea.firebaseio.com/"),i=h.child("event_related/event"),j=i.push(f,function(b){if(b)console.log("fail to save");else{var d=j.key(),e=h.child("event_related/game/"+d);e.set(g,function(b){b?console.log("error occured"):(console.log("succeed to save"),a.$parent.$parent.event_id=d,c(function(){a.$parent.$parent.event_create_status="saved"}))})}})},a.go_back_edit=function(){a.$parent.$parent.event_create_status="input"}}]),angular.module("mixideaWebApp").controller("CreateEventCompleteCtrl",["$scope","$state",function(a,b){a.goto_event_window=function(){console.log(a.$parent.$parent.event_id);var c=a.$parent.$parent.event_id;b.go("/eventcontext_layout_two_column.context",{id:c}),a.$parent.$parent.click_cancel()}}]),angular.module("mixideaWebApp").controller("EventLayoutCtrl",["$scope","$uibModal",function(a,b){console.log("event layout"),a.open_create_event=function(){console.log("create event is clicked");b.open({templateUrl:"views/event/create_event.html",controller:"CreateEventCtrl",backdrop:"static",size:"lg"})}}]),angular.module("mixideaWebApp").controller("EventCalendarCtrl",["$scope",function(a){console.log("event calendar"),a.name="calendar calendar"}]),angular.module("mixideaWebApp").controller("EventFilterCtrl",["$scope",function(a){console.log("event filter called"),a.name="event filter yuta",a.date_range_show=!1,a.date_from=new Date,a.date_to=new Date,a.date_to.setMonth(a.date_to.getMonth()+13),a.format="yyyy/MM/dd",a.time_from=new Date,a.time_from.setHours(0),a.time_from.setMinutes(0),a.time_to=new Date,a.time_to.setHours(23),a.time_to.setMinutes(59),a.date_range_in=function(){a.date_range_show||(a.date_range_show=!0)},a.data_range_out=function(){a.date_range_show&&(a.date_range_show=!1)},a.time_range_in=function(){a.time_range_show||(a.time_range_show=!0)},a.time_range_out=function(){a.time_range_show&&(a.time_range_show=!1)},a.week_range_in=function(){a.week_range_show||(a.week_range_show=!0)},a.week_range_out=function(){a.week_range_show&&(a.week_range_show=!1)},a.week_change=function(){console.log("aaa");var b=a.weeks.filter(function(a){return a.checked});if(7!=b.length){a.week_filtered=!0,a.active_days.length=0;for(var c=0;c<b.length;c++)a.active_days.push(b[c].short_name)}}}]),angular.module("mixideaWebApp").controller("EventListCtrl",["$scope","EventSearchService",function(a,b){a.event_list=b.event_list}]),angular.module("mixideaWebApp").filter("DateValueString",function(){return function(a){var b=new Date(a),c=b.toString();return c}});